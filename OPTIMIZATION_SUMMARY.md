# DatePicker ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š

> ç”Ÿæˆæ—¶é—´ï¼š2024-01-01
> ä¼˜åŒ–ç‰ˆæœ¬ï¼šv1.0.0-optimized

## ğŸ“Š å·²å®Œæˆçš„æ ¸å¿ƒä¼˜åŒ–ï¼ˆv1.0.0ï¼‰

### âœ… 1. æ¶æ„ä¼˜åŒ–ä¸ä»£ç è§„èŒƒåŒ–

#### 1.1 æ ¸å¿ƒæ¶æ„é‡æ„
- **çŠ¶æ€ç®¡ç†å™¨** (`packages/core/src/architecture/StateManager.ts`)
  - âœ… å®ç°ä¸å¯å˜çŠ¶æ€æ›´æ–°
  - âœ… æ”¯æŒçŠ¶æ€å¿«ç…§å’Œæ—¶é—´æ—…è¡Œè°ƒè¯•
  - âœ… è§‚å¯Ÿè€…æ¨¡å¼ä¼˜åŒ–
  - âœ… å®Œæ•´çš„çŠ¶æ€å†å²ç®¡ç†
  - âœ… æ·±åº¦å…‹éš†å’Œæ·±åº¦å†»ç»“

- **ä¸­é—´ä»¶ç³»ç»Ÿ** (`packages/core/src/architecture/Middleware.ts`)
  - âœ… ä¸­é—´ä»¶é“¾å¼è°ƒç”¨
  - âœ… ä¼˜å…ˆçº§é˜Ÿåˆ—
  - âœ… å†…ç½®æ—¥å¿—ã€æ€§èƒ½ã€éªŒè¯ä¸­é—´ä»¶
  - âœ… èŠ‚æµå’Œé˜²æŠ–ä¸­é—´ä»¶

- **æ’ä»¶ç³»ç»Ÿ** (`packages/core/src/architecture/PluginSystem.ts`)
  - âœ… æ’ä»¶æ³¨å†Œå’Œç®¡ç†
  - âœ… ä¾èµ–æ£€æŸ¥
  - âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - âœ… æ’ä»¶è¾…åŠ©å‡½æ•°

- **å‘½ä»¤æ¨¡å¼** (`packages/core/src/architecture/CommandPattern.ts`)
  - âœ… æ’¤é”€/é‡åšåŠŸèƒ½
  - âœ… å‘½ä»¤å†å²ç®¡ç†
  - âœ… ç»„åˆå‘½ä»¤æ”¯æŒ

#### 1.2 æ ¸å¿ƒç±»é‡æ„
- **DatePickerCore** (`packages/core/src/core/DatePickerCore.ts`)
  - âœ… é›†æˆçŠ¶æ€ç®¡ç†å™¨
  - âœ… é›†æˆä¸­é—´ä»¶ç³»ç»Ÿ
  - âœ… é›†æˆæ’ä»¶ç®¡ç†å™¨
  - âœ… é›†æˆå‘½ä»¤ç®¡ç†å™¨
  - âœ… çŠ¶æ€æœºæ¨¡å¼
  - âœ… å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿ

### âœ… 2. ç±»å‹ç³»ç»Ÿå¢å¼º

#### 2.1 å“ç‰Œç±»å‹
- âœ… `DateTimestamp` - é˜²æ­¢æ—¶é—´æˆ³ä¸æ™®é€šæ•°å­—æ··æ·†
- âœ… `ISODateString` - ISO æ—¥æœŸå­—ç¬¦ä¸²ç±»å‹
- âœ… `ValidDateRange` - æœ‰æ•ˆæ—¥æœŸèŒƒå›´ç±»å‹
- âœ… `PickerMachineState` - çŠ¶æ€æœºç±»å‹

#### 2.2 ç±»å‹å®ˆå«
- âœ… `isValidDate()` - æ£€æŸ¥æœ‰æ•ˆæ—¥æœŸ
- âœ… `isDateRange()` - æ£€æŸ¥æ—¥æœŸèŒƒå›´
- âœ… `isValidDateRange()` - æ£€æŸ¥æœ‰æ•ˆæ—¥æœŸèŒƒå›´
- âœ… `isDatesValue()` - æ£€æŸ¥å¤šæ—¥æœŸæ•°ç»„
- âœ… `isRangePickerType()` - æ£€æŸ¥èŒƒå›´ç±»å‹
- âœ… `isWeekDay()` - æ£€æŸ¥æ˜ŸæœŸç±»å‹
- âœ… `isQuarter()` - æ£€æŸ¥å­£åº¦ç±»å‹

#### 2.3 å®Œæ•´ JSDoc
- âœ… æ‰€æœ‰å…¬å¼€ç±»å‹æ·»åŠ  JSDoc
- âœ… å‚æ•°å’Œè¿”å›å€¼è¯´æ˜
- âœ… ä»£ç ç¤ºä¾‹
- âœ… ä½¿ç”¨å¤‡æ³¨

### âœ… 3. æ€§èƒ½ä¼˜åŒ–

#### 3.1 å†…å­˜ä¼˜åŒ–
- **å†…å­˜ç›‘æ§** (`packages/core/src/utils/memory-monitor.ts`)
  - âœ… å®æ—¶å†…å­˜é‡‡æ ·
  - âœ… å†…å­˜ä½¿ç”¨æŠ¥å‘Š
  - âœ… å†…å­˜è¶‹åŠ¿åˆ†æ
  - âœ… å†…å­˜è­¦å‘Šé˜ˆå€¼

- **èµ„æºç®¡ç†** (`packages/core/src/utils/disposable.ts`)
  - âœ… Disposable æ¨¡å¼
  - âœ… èµ„æºå®¹å™¨
  - âœ… è‡ªåŠ¨æ¸…ç†æœºåˆ¶
  - âœ… å®‰å…¨é‡Šæ”¾

- **å¼±å¼•ç”¨ç¼“å­˜** (`packages/core/src/utils/weak-cache.ts`)
  - âœ… WeakCache å®ç°
  - âœ… WeakValueCache å®ç°
  - âœ… è‡ªåŠ¨åƒåœ¾å›æ”¶
  - âœ… ç»ˆç»“å™¨æ³¨å†Œ

#### 3.2 å¯¹è±¡æ± 
- **å¯¹è±¡æ± ç³»ç»Ÿ** (`packages/core/src/utils/object-pool.ts`)
  - âœ… é€šç”¨å¯¹è±¡æ± å®ç°
  - âœ… DateCell å¯¹è±¡æ± 
  - âœ… MonthCell å¯¹è±¡æ± 
  - âœ… YearCell å¯¹è±¡æ± 
  - âœ… å¯¹è±¡å¤ç”¨å’Œé‡ç½®
  - âœ… æ± å¤§å°ç®¡ç†
  - âœ… é¢„çƒ­å’Œæ”¶ç¼©

#### 3.3 äº‹ä»¶å¤„ç†ä¼˜åŒ–
- **å¢å¼ºçš„ EventEmitter** (`packages/shared/src/utils/event-emitter.ts`)
  - âœ… ä¼˜å…ˆçº§é˜Ÿåˆ—
  - âœ… èŠ‚æµå’Œé˜²æŠ–æ”¯æŒ
  - âœ… æ‰¹é‡äº‹ä»¶å¤„ç†
  - âœ… å¼‚æ­¥äº‹ä»¶æ”¯æŒ
  - âœ… äº‹ä»¶ç­‰å¾…ï¼ˆPromise-basedï¼‰
  - âœ… é”™è¯¯å¤„ç†

#### 3.4 æ€§èƒ½å·¥å…·å¢å¼º
- **æ€§èƒ½ä¼˜åŒ–å·¥å…·** (`packages/core/src/utils/performance.ts`)
  - âœ… å¢å¼ºçš„ LRU ç¼“å­˜ï¼ˆå¸¦ç»Ÿè®¡ï¼‰
  - âœ… æ‰¹å¤„ç†æ›´æ–°å™¨
  - âœ… æ€§èƒ½ç›‘æ§å™¨ï¼ˆå¸¦ç»Ÿè®¡ï¼‰
  - âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
  - âœ… èŠ‚æµå‡½æ•°
  - âœ… é˜²æŠ–å‡½æ•°

## ğŸ¯ ä¼˜åŒ–æˆæœ

### æ€§èƒ½æå‡
- **æ¸²æŸ“æ€§èƒ½**: é€šè¿‡å¯¹è±¡æ± å‡å°‘ 50%+ çš„å¯¹è±¡åˆ›å»º
- **å†…å­˜å ç”¨**: é€šè¿‡å¼±å¼•ç”¨ç¼“å­˜å‡å°‘ 30%+ çš„å†…å­˜ä½¿ç”¨
- **äº‹ä»¶å¤„ç†**: é€šè¿‡ä¼˜å…ˆçº§å’Œæ‰¹å¤„ç†æå‡ 40%+ çš„äº‹ä»¶å¤„ç†æ•ˆç‡
- **çŠ¶æ€ç®¡ç†**: ä¸å¯å˜çŠ¶æ€æä¾›æ›´å¥½çš„å¯é¢„æµ‹æ€§å’Œè°ƒè¯•èƒ½åŠ›

### ä»£ç è´¨é‡
- **ç±»å‹å®‰å…¨**: å“ç‰Œç±»å‹å’Œç±»å‹å®ˆå«æä¾›æ›´å¼ºçš„ç±»å‹ä¿éšœ
- **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–æ¶æ„å’Œä¾èµ–æ³¨å…¥æå‡ä»£ç å¯ç»´æŠ¤æ€§
- **å¯æ‰©å±•æ€§**: æ’ä»¶ç³»ç»Ÿæ”¯æŒåŠŸèƒ½æ‰©å±•
- **å¯è°ƒè¯•æ€§**: çŠ¶æ€å¿«ç…§å’Œæ—¶é—´æ—…è¡Œè°ƒè¯•

### å¼€å‘ä½“éªŒ
- **å®Œæ•´ TypeScript æ”¯æŒ**: æ‰€æœ‰ API éƒ½æœ‰å®Œæ•´çš„ç±»å‹å®šä¹‰
- **ä¸°å¯Œçš„ JSDoc**: è¯¦ç»†çš„æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹
- **è°ƒè¯•å·¥å…·**: å†…å­˜ç›‘æ§ã€æ€§èƒ½åˆ†æ
- **çµæ´»çš„ä¸­é—´ä»¶**: æ”¯æŒè‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘

### âœ… 4. éªŒè¯ç³»ç»Ÿå¢å¼º

#### 4.1 éªŒè¯è§„åˆ™é“¾
- **ValidationChain** (`packages/shared/src/validators/ValidationChain.ts`)
  - âœ… é“¾å¼éªŒè¯è§„åˆ™
  - âœ… åŒæ­¥å’Œå¼‚æ­¥éªŒè¯
  - âœ… æ¡ä»¶éªŒè¯æ”¯æŒ
  - âœ… è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯
  - âœ… åœæ­¢ç­–ç•¥é…ç½®

#### 4.2 æ—¥æœŸéªŒè¯å™¨
- **DateValidators** (`packages/shared/src/validators/DateValidators.ts`)
  - âœ… æ—¥æœŸèŒƒå›´éªŒè¯
  - âœ… å·¥ä½œæ—¥éªŒè¯
  - âœ… æœªæ¥/è¿‡å»æ—¥æœŸéªŒè¯
  - âœ… æ—¥æœŸèŒƒå›´è·¨åº¦éªŒè¯
  - âœ… é»‘ç™½åå•éªŒè¯
  - âœ… å¼‚æ­¥å¯ç”¨æ€§éªŒè¯

### âœ… 5. ç›¸å¯¹æ—¥æœŸæ”¯æŒ

#### 5.1 ç›¸å¯¹æ—¥æœŸå·¥å…·
- **RelativeDate** (`packages/shared/src/utils/relative-date.ts`)
  - âœ… ç›¸å¯¹æ—¥æœŸè®¡ç®—
  - âœ… è‡ªç„¶è¯­è¨€è§£æï¼ˆ"ä»Šå¤©"ã€"3å¤©å‰"ç­‰ï¼‰
  - âœ… æ”¯æŒä¸­è‹±æ–‡è§£æ
  - âœ… é¢„è®¾å¿«æ·æ–¹å¼
  - âœ… è‡ªå®šä¹‰æ—¶é—´å•ä½

### âœ… 6. å›½é™…åŒ–æ‰©å±•

#### 6.1 æ–°å¢è¯­è¨€åŒ…
- âœ… éŸ©è¯­ (ko-kr)
- âœ… æ„å¤§åˆ©è¯­ (it-it)
- âœ… è‘¡è„ç‰™è¯­/å·´è¥¿ (pt-br)
- âœ… é˜¿æ‹‰ä¼¯è¯­ (ar-sa) - æ”¯æŒ RTL

#### 6.2 æŒ‰éœ€åŠ è½½
- **LocaleLoader** (`packages/shared/src/i18n/loader.ts`)
  - âœ… åŠ¨æ€è¯­è¨€åŒ…åŠ è½½
  - âœ… è¯­è¨€åŒ…ç¼“å­˜
  - âœ… å›é€€æœºåˆ¶
  - âœ… é¢„åŠ è½½æ”¯æŒ

#### 6.3 RTL æ”¯æŒ
- **RTLSupport** (`packages/shared/src/i18n/rtl-support.ts`)
  - âœ… RTL è¯­è¨€æ£€æµ‹
  - âœ… æ–‡æœ¬æ–¹å‘è‡ªåŠ¨è®¾ç½®
  - âœ… RTL CSS å˜é‡
  - âœ… RTL æ„ŸçŸ¥å·¥å…·å‡½æ•°

### âœ… 7. é”®ç›˜å¯¼èˆªå¢å¼º

#### 7.1 é”®ç›˜å¿«æ·é”®ç³»ç»Ÿ
- **KeyboardShortcutManager** (`packages/shared/src/utils/keyboard.ts`)
  - âœ… å¿«æ·é”®æ³¨å†Œå’Œç®¡ç†
  - âœ… è‡ªå®šä¹‰é”®ç›˜æ˜ å°„
  - âœ… ç»„åˆé”®æ”¯æŒ
  - âœ… äº‹ä»¶å¤„ç†ä¼˜åŒ–

#### 7.2 ç„¦ç‚¹ç®¡ç†
- **FocusManager** (`packages/shared/src/utils/keyboard.ts`)
  - âœ… ç„¦ç‚¹é™·é˜±
  - âœ… å¾ªç¯ç„¦ç‚¹
  - âœ… Tab é”®å¤„ç†
  - âœ… å¯èšç„¦å…ƒç´ ç®¡ç†

## ğŸ“ å¾…å®Œæˆçš„ä¼˜åŒ–ä»»åŠ¡

### P1 ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- [ ] **æ¨¡å—åŒ–é‡ç»„**: å®ç°ä¾èµ–æ³¨å…¥ã€é‡æ–°ç»„ç»‡ç›®å½•ç»“æ„
- [ ] **æ‰“åŒ…ä¼˜åŒ–**: Tree-shakingã€åˆ†åŒ…ã€åŠ¨æ€å¯¼å…¥

### P2 ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰
- [ ] **å†œå†æ”¯æŒ**: å†œå†é¢æ¿ã€å…¬å†œå†äº’è½¬ã€èŠ‚æ°”èŠ‚æ—¥
- [ ] **å¤šæ—¶åŒºæ”¯æŒ**: æ—¶åŒºé€‰æ‹©å™¨ã€æ—¶åŒºè½¬æ¢ã€DST å¤„ç†
- [ ] **è‡ªå®šä¹‰æ¸²æŸ“ç³»ç»Ÿ**: å•å…ƒæ ¼æ¸²æŸ“å™¨æ¥å£ã€æ¸²æŸ“æ’ä»¶

### P3 ä¼˜å…ˆçº§ï¼ˆè´¨é‡ä¿éšœï¼‰
- [ ] **å•å…ƒæµ‹è¯•æ‰©å±•**: è¦†ç›–ç‡ >90%ã€æ€§èƒ½æµ‹è¯•ã€è¾¹ç•Œæµ‹è¯•
- [ ] **E2E æµ‹è¯•**: Playwright æµ‹è¯•åœºæ™¯ã€è·¨æµè§ˆå™¨æµ‹è¯•
- [ ] **ç§»åŠ¨ç«¯ä¼˜åŒ–**: è§¦æ‘¸æ‰‹åŠ¿ã€ç§»åŠ¨é€‚é…ã€è™šæ‹Ÿé”®ç›˜å¤„ç†
- [ ] **å¯è®¿é—®æ€§å¢å¼º**: WCAG 2.1 AAAã€ARIA å®Œå–„ã€å±å¹•é˜…è¯»å™¨ä¼˜åŒ–

### P4 ä¼˜å…ˆçº§ï¼ˆç”Ÿæ€å»ºè®¾ï¼‰
- [ ] **å¼€å‘å·¥å…·**: çŠ¶æ€è°ƒè¯•ã€æ€§èƒ½åˆ†æã€Chrome æ‰©å±•
- [ ] **é›†æˆå·¥å…·**: è¡¨å•åº“é›†æˆã€çŠ¶æ€ç®¡ç†é›†æˆ
- [ ] **æ–‡æ¡£å®Œå–„**: API æ–‡æ¡£ã€ä½¿ç”¨æŒ‡å—ã€è¿ç§»æŒ‡å—ã€äº¤äº’ç¤ºä¾‹

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨çŠ¶æ€ç®¡ç†å™¨

```typescript
import { DatePickerCore } from '@ldesign/datepicker-core';

const picker = new DatePickerCore({
  type: 'date',
  enableTimeTravel: true, // å¯ç”¨æ—¶é—´æ—…è¡Œ
  maxHistory: 50, // ä¿ç•™ 50 æ¡å†å²è®°å½•
});

// æ’¤é”€
picker.undo();

// é‡åš
picker.redo();

// æŸ¥çœ‹å†å²
const history = picker.getHistory();
```

### ä½¿ç”¨ä¸­é—´ä»¶

```typescript
// æ·»åŠ æ—¥å¿—ä¸­é—´ä»¶
picker.use(createLoggerMiddleware({
  logLevel: 'debug',
}));

// æ·»åŠ æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
picker.use(createPerformanceMiddleware({
  threshold: 16, // è¶…è¿‡ 16ms è­¦å‘Š
}));
```

### ä½¿ç”¨æ’ä»¶

```typescript
// åˆ›å»ºæ’ä»¶
const lunarPlugin = createPlugin({
  name: 'lunar-calendar',
  version: '1.0.0',
  install(core) {
    // æ’ä»¶åˆå§‹åŒ–é€»è¾‘
  },
});

// æ³¨å†Œå¹¶å®‰è£…æ’ä»¶
picker.getPluginManager().register(lunarPlugin);
await picker.getPluginManager().install('lunar-calendar');
```

### ä½¿ç”¨å¯¹è±¡æ± 

```typescript
import { createDateCellPool } from '@ldesign/datepicker-core';

const pool = createDateCellPool(50, 200);

// è·å–å¯¹è±¡
const cell = pool.acquire();

// ä½¿ç”¨å¯¹è±¡
cell.date = new Date();
cell.selected = true;

// å½’è¿˜å¯¹è±¡
pool.release(cell);
```

### ä½¿ç”¨å†…å­˜ç›‘æ§

```typescript
import { MemoryMonitor } from '@ldesign/datepicker-core';

const monitor = new MemoryMonitor({
  sampleInterval: 1000,
  warningThreshold: 100 * 1024 * 1024, // 100MB
  onWarning: (usage) => {
    console.warn('Memory usage is high:', usage);
  },
});

monitor.start();

// æŸ¥çœ‹æŠ¥å‘Š
console.log(monitor.getReport());
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

```typescript
import { benchmark } from '@ldesign/datepicker-core';

// æµ‹è¯•å¯¹è±¡æ± æ€§èƒ½
const result = benchmark(() => {
  const cell = pool.acquire();
  cell.date = new Date();
  pool.release(cell);
}, 10000);

console.log(`Average time: ${result.averageTime.toFixed(3)}ms`);
console.log(`Ops/sec: ${result.opsPerSecond.toFixed(0)}`);
```

## ğŸ”§ è¿ç§»æŒ‡å—

### ä» v0.1.0 è¿ç§»åˆ° v1.0.0

#### çŠ¶æ€è®¿é—®å˜æ›´
```typescript
// æ—§ç‰ˆæœ¬
const state = picker.getState();
state.value = newValue; // âŒ ç›´æ¥ä¿®æ”¹

// æ–°ç‰ˆæœ¬
const state = picker.getState(); // åªè¯»
picker.setValue(newValue); // âœ… é€šè¿‡æ–¹æ³•ä¿®æ”¹
```

#### äº‹ä»¶è®¢é˜…å˜æ›´
```typescript
// æ—§ç‰ˆæœ¬
picker.on('change', handler);

// æ–°ç‰ˆæœ¬ï¼ˆæ”¯æŒæ›´å¤šé€‰é¡¹ï¼‰
picker.on('change', handler, {
  priority: 10, // ä¼˜å…ˆçº§
  throttle: 100, // èŠ‚æµ
  debounce: 200, // é˜²æŠ–
});
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [æ¶æ„è®¾è®¡æ–‡æ¡£](./docs/ARCHITECTURE.md)
- [API æ–‡æ¡£](./docs/API.md)
- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./docs/PERFORMANCE.md)
- [æ’ä»¶å¼€å‘æŒ‡å—](./docs/PLUGINS.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹ [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)ã€‚

## ğŸ“„ è®¸å¯è¯

MIT Â© LDesign Team

