# DatePicker æ¶æ„è®¾è®¡

> v1.0.0-optimized æ¶æ„æ–‡æ¡£

## ğŸ“ æ€»ä½“æ¶æ„

DatePicker é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œæ ¸å¿ƒé€»è¾‘æ¡†æ¶æ— å…³ï¼Œé€šè¿‡é€‚é…å™¨æ”¯æŒå¤šä¸ªæ¡†æ¶ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ¡†æ¶å±‚ (Vue/React/Lit)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Vue Adapter â”‚ â”‚React Adapterâ”‚ â”‚ Lit Adapter â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ ¸å¿ƒå±‚ (Core)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           DatePickerCore                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚StateManager  â”‚  â”‚MiddlewareMan â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚PluginManager â”‚  â”‚CommandManagerâ”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Panels  â”‚ â”‚Calculatorsâ”‚ â”‚Renderers â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å…±äº«å±‚ (Shared)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Types   â”‚ â”‚  Utils   â”‚ â”‚Validatorsâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Locales  â”‚ â”‚   I18n   â”‚ â”‚Constants â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

### StateManagerï¼ˆçŠ¶æ€ç®¡ç†å™¨ï¼‰

è´Ÿè´£ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼Œæ”¯æŒä¸å¯å˜æ›´æ–°å’Œæ—¶é—´æ—…è¡Œã€‚

**ç‰¹æ€§:**
- âœ… ä¸å¯å˜çŠ¶æ€
- âœ… çŠ¶æ€å¿«ç…§
- âœ… æ’¤é”€/é‡åš
- âœ… è®¢é˜…æœºåˆ¶
- âœ… æ·±åº¦å…‹éš†å’Œå†»ç»“

**ä½¿ç”¨åœºæ™¯:**
- çŠ¶æ€è¿½è¸ª
- è°ƒè¯•
- æ—¶é—´æ—…è¡Œ

### MiddlewareManagerï¼ˆä¸­é—´ä»¶ç®¡ç†å™¨ï¼‰

æä¾›ä¸­é—´ä»¶æœºåˆ¶ï¼Œå…è®¸åœ¨çŠ¶æ€å˜æ›´æ—¶æ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

**ç‰¹æ€§:**
- âœ… ä¼˜å…ˆçº§é˜Ÿåˆ—
- âœ… å¼‚æ­¥ä¸­é—´ä»¶
- âœ… é”™è¯¯å¤„ç†
- âœ… å†…ç½®ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€æ€§èƒ½ã€éªŒè¯ï¼‰

**ä½¿ç”¨åœºæ™¯:**
- æ—¥å¿—è®°å½•
- æ€§èƒ½ç›‘æ§
- çŠ¶æ€éªŒè¯
- ä¸šåŠ¡é€»è¾‘

### PluginManagerï¼ˆæ’ä»¶ç®¡ç†å™¨ï¼‰

æ”¯æŒæ’ä»¶åŒ–æ‰©å±•åŠŸèƒ½ã€‚

**ç‰¹æ€§:**
- âœ… æ’ä»¶æ³¨å†Œ
- âœ… ä¾èµ–ç®¡ç†
- âœ… ç”Ÿå‘½å‘¨æœŸé’©å­
- âœ… é…ç½®ä¼ é€’

**ä½¿ç”¨åœºæ™¯:**
- åŠŸèƒ½æ‰©å±•
- è‡ªå®šä¹‰é¢æ¿
- ç¬¬ä¸‰æ–¹é›†æˆ

### CommandManagerï¼ˆå‘½ä»¤ç®¡ç†å™¨ï¼‰

å®ç°å‘½ä»¤æ¨¡å¼ï¼Œæ”¯æŒæ“ä½œçš„æ’¤é”€å’Œé‡åšã€‚

**ç‰¹æ€§:**
- âœ… å‘½ä»¤å†å²
- âœ… æ’¤é”€/é‡åš
- âœ… ç»„åˆå‘½ä»¤
- âœ… å¼‚æ­¥å‘½ä»¤

**ä½¿ç”¨åœºæ™¯:**
- æ’¤é”€/é‡åš
- æ‰¹é‡æ“ä½œ
- äº‹åŠ¡å¤„ç†

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. è§‚å¯Ÿè€…æ¨¡å¼

çŠ¶æ€ç®¡ç†å™¨ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼é€šçŸ¥çŠ¶æ€å˜æ›´ã€‚

```typescript
stateManager.subscribe((newState, oldState) => {
  // å“åº”çŠ¶æ€å˜æ›´
});
```

### 2. ä¸­é—´ä»¶æ¨¡å¼

ä¸­é—´ä»¶é“¾å¼è°ƒç”¨å¤„ç†çŠ¶æ€å˜æ›´ã€‚

```typescript
picker.use((context, next) => {
  // å‰ç½®å¤„ç†
  next();
  // åç½®å¤„ç†
});
```

### 3. å‘½ä»¤æ¨¡å¼

æ“ä½œå°è£…ä¸ºå‘½ä»¤ï¼Œæ”¯æŒæ’¤é”€å’Œé‡åšã€‚

```typescript
const command = createCommand({
  execute: () => { /* ... */ },
  undo: () => { /* ... */ },
});

commandManager.execute(command);
commandManager.undo();
```

### 4. å¯¹è±¡æ± æ¨¡å¼

å¤ç”¨å¯¹è±¡å‡å°‘å†…å­˜åˆ†é…ã€‚

```typescript
const pool = createDateCellPool();
const cell = pool.acquire();
// use cell
pool.release(cell);
```

### 5. ç­–ç•¥æ¨¡å¼

ä¸åŒçš„éªŒè¯ç­–ç•¥ã€æ¸²æŸ“ç­–ç•¥ç­‰ã€‚

```typescript
const validator = createDateValidationChain()
  .custom(strategy1)
  .custom(strategy2);
```

## ğŸ“Š æ•°æ®æµ

### å•å‘æ•°æ®æµ

```
ç”¨æˆ·äº¤äº’
    â†“
äº‹ä»¶å¤„ç†
    â†“
ä¸­é—´ä»¶é“¾
    â†“
çŠ¶æ€æ›´æ–°
    â†“
è§†å›¾æ›´æ–°
```

### çŠ¶æ€å˜æ›´æµç¨‹

```
setValue()
    â†“
StateManager.setState()
    â†“
MiddlewareManager.run()
    â†“
State Update
    â†“
Notify Subscribers
    â†“
UI Update
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å¯¹è±¡æ± 

é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ã€‚

### 2. LRU ç¼“å­˜

ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚

### 3. å¼±å¼•ç”¨

å…è®¸å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

### 4. æ‰¹é‡æ›´æ–°

åˆå¹¶å¤šä¸ªæ›´æ–°åˆ°ä¸€ä¸ªæ¸²æŸ“å‘¨æœŸã€‚

### 5. è™šæ‹ŸåŒ–

åªæ¸²æŸ“å¯è§éƒ¨åˆ†ï¼Œå‡å°‘ DOM èŠ‚ç‚¹ã€‚

## ğŸ“¦ æ¨¡å—ç»„ç»‡

### Core åŒ…

```
packages/core/src/
â”œâ”€â”€ architecture/      # æ¶æ„ç»„ä»¶
â”‚   â”œâ”€â”€ StateManager.ts
â”‚   â”œâ”€â”€ Middleware.ts
â”‚   â”œâ”€â”€ PluginSystem.ts
â”‚   â””â”€â”€ CommandPattern.ts
â”œâ”€â”€ core/              # æ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ DatePickerCore.ts
â”œâ”€â”€ panels/            # é¢æ¿ç»„ä»¶
â”‚   â”œâ”€â”€ date-panel.ts
â”‚   â”œâ”€â”€ lunar-panel.ts
â”‚   â””â”€â”€ timezone-panel.ts
â”œâ”€â”€ calculators/       # è®¡ç®—å™¨
â”‚   â”œâ”€â”€ LunarCalendar.ts
â”‚   â””â”€â”€ Timezone.ts
â”œâ”€â”€ renderers/         # æ¸²æŸ“å™¨
â”‚   â””â”€â”€ CellRenderer.ts
â”œâ”€â”€ mobile/            # ç§»åŠ¨ç«¯
â”‚   â”œâ”€â”€ TouchGesture.ts
â”‚   â””â”€â”€ MobileAdapter.ts
â””â”€â”€ utils/             # å·¥å…·
    â”œâ”€â”€ performance.ts
    â”œâ”€â”€ object-pool.ts
    â”œâ”€â”€ memory-monitor.ts
    â””â”€â”€ ...
```

### Shared åŒ…

```
packages/shared/src/
â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ validators/        # éªŒè¯å™¨
â”œâ”€â”€ locales/           # è¯­è¨€åŒ…
â”œâ”€â”€ i18n/              # å›½é™…åŒ–
â””â”€â”€ constants/         # å¸¸é‡
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

- æ ¸å¿ƒé€»è¾‘è¦†ç›–ç‡ >90%
- å·¥å…·å‡½æ•°è¦†ç›–ç‡ 100%
- ä½¿ç”¨ Vitest

### E2E æµ‹è¯•

- Playwright æµ‹è¯•
- è·¨æµè§ˆå™¨å…¼å®¹æ€§
- ç§»åŠ¨ç«¯æµ‹è¯•

### æ€§èƒ½æµ‹è¯•

- åŸºå‡†æµ‹è¯•
- å†…å­˜æ³„æ¼æ£€æµ‹
- å‹åŠ›æµ‹è¯•

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ç±»å‹å®ˆå«

```typescript
import { isValidDate, isDateRange } from '@ldesign/datepicker-shared';

if (isValidDate(value)) {
  // value ç°åœ¨æ˜¯ Date ç±»å‹
}
```

### 2. å¯ç”¨ç¼“å­˜

```typescript
const picker = new DatePickerCore({
  type: 'date',
  enableCache: true, // å¯ç”¨ LRU ç¼“å­˜
});
```

### 3. ä½¿ç”¨å¯¹è±¡æ± 

```typescript
import { createDateCellPool } from '@ldesign/datepicker-core';

const pool = createDateCellPool(50, 200);
// å¤ç”¨å¯¹è±¡ï¼Œå‡å°‘ GC å‹åŠ›
```

### 4. ç›‘æ§æ€§èƒ½

```typescript
import { MemoryMonitor } from '@ldesign/datepicker-core';

const monitor = new MemoryMonitor();
monitor.start();
```

## ğŸ”® æœªæ¥è§„åˆ’

### v1.1.0
- å®Œæ•´çš„å†œå†æ•°æ®è¡¨
- æ›´å¤šæ—¶åŒºæ”¯æŒ
- ç§»åŠ¨ç«¯æ‰‹åŠ¿ä¼˜åŒ–

### v1.2.0
- Chrome DevTools æ‰©å±•
- æ›´å¤šé›†æˆå·¥å…·
- å¯è§†åŒ–é…ç½®å™¨

## å‚è€ƒèµ„æ–™

- [ä¼˜åŒ–æ€»ç»“](../OPTIMIZATION_SUMMARY.md)
- [åŠŸèƒ½ç¤ºä¾‹](../FEATURE_EXAMPLES.md)
- [API æ–‡æ¡£](./API.md)

